blueprint:
  name: Light/Switch Scheduler (with days of week)
  description: >
    Turn a light or switch on/off at set times or around sunset/sunrise,
    with toggles for each trigger type and selectable days of the week.
  domain: automation
  input:
    target_entity:
      name: Light or Switch
      selector:
        entity:
          domain:
            - light
            - switch

    enable_time_on:
      name: Enable Turn ON Time
      default: false
      selector:
        boolean:

    turn_on_time:
      name: Turn ON Time
      default: "00:00:00"
      selector:
        time:

    enable_time_off:
      name: Enable Turn OFF Time
      default: false
      selector:
        boolean:

    turn_off_time:
      name: Turn OFF Time
      default: "00:00:00"
      selector:
        time:

    enable_sunset:
      name: Enable Sunset Trigger
      default: false
      selector:
        boolean:

    sunset_offset:
      name: Sunset Offset
      default: "0:00:00"
      selector:
        text:

    enable_sunrise:
      name: Enable Sunrise Trigger
      default: false
      selector:
        boolean:

    sunrise_offset:
      name: Sunrise Offset
      default: "0:00:00"
      selector:
        text:

    active_days:
      name: Active Days
      description: Days of the week when this automation should run
      default:
        - mon
        - tue
        - wed
        - thu
        - fri
        - sat
        - sun
      selector:
        select:
          multiple: true
          mode: list
          options:
            - label: Monday
              value: mon
            - label: Tuesday
              value: tue
            - label: Wednesday
              value: wed
            - label: Thursday
              value: thu
            - label: Friday
              value: fri
            - label: Saturday
              value: sat
            - label: Sunday
              value: sun

mode: single

trigger:
  - platform: time
    at: !input turn_on_time
    id: time_on
  - platform: time
    at: !input turn_off_time
    id: time_off
  - platform: sun
    event: sunset
    offset: !input sunset_offset
    id: sunset
  - platform: sun
    event: sunrise
    offset: !input sunrise_offset
    id: sunrise

condition:
  - condition: template
    value_template: >
      {{ now().strftime('%a')|lower in (!input active_days) }}

  - condition: or
    conditions:
      - condition: and
        conditions:
          - condition: trigger
            id: time_on
          - condition: template
            value_template: "{{ !input enable_time_on }}"
      - condition: and
        conditions:
          - condition: trigger
            id: time_off
          - condition: template
            value_template: "{{ !input enable_time_off }}"
      - condition: and
        conditions:
          - condition: trigger
            id: sunset
          - condition: template
            value_template: "{{ !input enable_sunset }}"
      - condition: and
        conditions:
          - condition: trigger
            id: sunrise
          - condition: template
            value_template: "{{ !input enable_sunrise }}"

action:
  - choose:
      - conditions:
          - condition: trigger
            id: time_on
        sequence:
          - service: homeassistant.turn_on
            target:
              entity_id: !input target_entity
      - conditions:
          - condition: trigger
            id: time_off
        sequence:
          - service: homeassistant.turn_off
            target:
              entity_id: !input target_entity
      - conditions:
          - condition: trigger
            id: sunset
        sequence:
          - service: homeassistant.turn_on
            target:
              entity_id: !input target_entity
      - conditions:
          - condition: trigger
            id: sunrise
        sequence:
          - service: homeassistant.turn_off
            target:
              entity_id: !input target_entity
