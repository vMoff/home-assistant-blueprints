blueprint:
  name: Light/Switch Scheduler
  description: >
    Turn a light or switch on/off at set times or around sunset/sunrise.
    Each option can be enabled/disabled with a toggle for clarity.
  domain: automation
  input:
    target_entity:
      name: Light or Switch
      description: Choose the light or switch to control.
      selector:
        entity:
          domain:
            - light
            - switch

    enable_time_on:
      name: Enable Turn ON Time
      default: false
      selector:
        boolean:

    turn_on_time:
      name: Turn ON Time
      description: Time to turn on (only shown if enabled)
      default: "00:00:00"
      selector:
        conditional:
          condition: input
          input: enable_time_on
          true:
            time:

    enable_time_off:
      name: Enable Turn OFF Time
      default: false
      selector:
        boolean:

    turn_off_time:
      name: Turn OFF Time
      description: Time to turn off (only shown if enabled)
      default: "00:00:00"
      selector:
        conditional:
          condition: input
          input: enable_time_off
          true:
            time:

    enable_sunset:
      name: Enable Sunset Trigger
      default: false
      selector:
        boolean:

    sunset_offset:
      name: Sunset Offset
      description: Offset from sunset (e.g. -00:15:00 for before, +00:10:00 for after).
      default: "0:00:00"
      selector:
        conditional:
          condition: input
          input: enable_sunset
          true:
            text:

    enable_sunrise:
      name: Enable Sunrise Trigger
      default: false
      selector:
        boolean:

    sunrise_offset:
      name: Sunrise Offset
      description: Offset from sunrise (e.g. +00:20:00 for after).
      default: "0:00:00"
      selector:
        conditional:
          condition: input
          input: enable_sunrise
          true:
            text:

mode: single

trigger:
  - platform: time
    at: !input turn_on_time
    id: time_on
  - platform: time
    at: !input turn_off_time
    id: time_off
  - platform: sun
    event: sunset
    offset: !input sunset_offset
    id: sunset
  - platform: sun
    event: sunrise
    offset: !input sunrise_offset
    id: sunrise

condition:
  - condition: or
    conditions:
      - condition: and
        conditions:
          - condition: trigger
            id: time_on
          - condition: template
            value_template: "{{ !input enable_time_on }}"
      - condition: and
        conditions:
          - condition: trigger
            id: time_off
          - condition: template
            value_template: "{{ !input enable_time_off }}"
      - condition: and
        conditions:
          - condition: trigger
            id: sunset
          - condition: template
            value_template: "{{ !input enable_sunset }}"
      - condition: and
        conditions:
          - condition: trigger
            id: sunrise
          - condition: template
            value_template: "{{ !input enable_sunrise }}"

action:
  - choose:
      - conditions:
          - condition: trigger
            id: time_on
        sequence:
          - service: homeassistant.turn_on
            target:
              entity_id: !input target_entity
      - conditions:
          - condition: trigger
            id: time_off
        sequence:
          - service: homeassistant.turn_off
            target:
              entity_id: !input target_entity
      - conditions:
          - condition: trigger
            id: sunset
        sequence:
          - service: homeassistant.turn_on
            target:
              entity_id: !input target_entity
      - conditions:
          - condition: trigger
            id: sunrise
        sequence:
          - service: homeassistant.turn_off
            target:
              entity_id: !input target_entity
